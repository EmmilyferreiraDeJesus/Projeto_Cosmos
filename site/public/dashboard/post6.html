<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../js/sessao.js"></script>

    <!--Link CSS-->
    <link rel="stylesheet" href="../css/estilo.css">
    <!--Link Google Icons-->
    <link rel="shortcut icon" href="../assets/LOGOTIPO.png" type="image/x-icon">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <title>Cosmos | Lua se encontra com Júpiter após eclipse</title>
</head>

<!-- validarSessao(), -->

<body onload="atualizarFeed()">

    <!--Container com a imagem principal e header-->
    <div class="container-principal-blog">

        <div class="header">
            <div class="container">

                <p class="email">
                    <span class="material-symbols-outlined">mail</span>
                    <a href="#">emmily.ferreira@spetch.school</a>
                </p>

                <a><img class="logo-blog" src="../assets/LOGOTIPO.png" alt="Logo Cosmos"></a>

                <div class="navbar">
                    <ul>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="#" onclick="limparSessao()">Sair</a></li>
                    </ul>
                </div>
            </div>

            <div class="conteudo-principal-blog">

                <h1>Blog</h1>

            </div>

        </div>

    </div>


    <!--Container da postagem-->
    <div class="container-postagem">

        <div class="postagem">

            <h1>Lua se encontra com Júpiter após eclipse</h1>
            <p class="data-post-p">
                <span class="material-symbols-outlined icon">calendar_clock</span>
                Abril 19, 2023 ás 08:50
            </p>

            <p>Poucas horas depois do eclipse lunar, a Lua já poderá ser vista perto de Júpiter, com quem estará em
                conjunção na manhã de domingo (19)</p>

            <img src="../assets/eclipse.jpg">

            <p><em>Lua cheia vista próxima ao planeta Júpiter. Crédito: AstroStar - Shutterstock</em></p>

            <p> Neste sábado (28), acontece o último eclipse de 2023, que desta vez será lunar (saiba tudo aqui). A
                maior parte do Brasil verá somente a fase penumbral, o que significa que as mudanças na coloração da Lua
                devem ser muito tênues, quase imperceptíveis a olho nu. Alguns locais do Nordeste, no entanto, podem
                testemunhar um pouco mais do evento – que será transmitido por várias plataformas digitais, para que
                ninguém perca nenhum detalhe. <br> <br>

                Finalizado este grande espetáculo, a Lua segue seu caminho em volta da Terra, podendo ser vista no céu
                bem pertinho de Júpiter algumas horas depois, em um fenômeno conhecido como conjunção astronômica. O
                maior planeta do Sistema Solar foi o primeiro e será o último a ser visitado por ela este mês. <br> <br>
            </p>

            <img src="../assets/conjuncao-lua-jupiter-29-10-23.jpg">

            <p><em>Configuração do céu no momento da conjunção entre a Lua e Júpiter neste domingo (29). Crédito:
                    SolarSystemScope</em></p> <br> <br>

            <h3>Aproximação máxima entre a Lua e Júpiter será antes da conjunção</h3>

            <p>
                De acordo com o guia de observação InTheSky.org, a conjunção entre Lua e Júpiter se dará no domingo
                (29), às 5h14 da manhã. Um pouco antes, às 3h10, acontece o chamado appulse, termo que se refere à
                separação mínima aparente entre dois corpos no céu, de acordo com o guia de astronomia Starwalk Space –
                todos os horários aqui mencionados têm como referência o fuso de Brasília. <br> <br>

                O que diferencia as duas expressões é que, embora o termo “conjunção” também seja utilizado popularmente
                para representar uma aproximação aparente entre dois astros, tecnicamente, a conjunção astronômica só
                ocorre no instante em que eles compartilham a mesma ascensão reta (coordenada astronômica equivalente à
                longitude terrestre). <br> <br>

                Ambos os momentos poderão ser observados. No céu de São Paulo, por exemplo, a dupla estará visível das
                18h35 até quase 6h da manhã. <br> <br>

                A Lua estará com -12.7 de magnitude, e a de Júpiter será de -2.9, com ambos na constelação de Áries.
                Quanto mais brilhante um objeto parece, menor é o valor de sua magnitude (relação inversa). O Sol, por
                exemplo, que é o objeto mais brilhante do céu, tem magnitude aparente de -27. <br> <br>

                O par não estará próximo o bastante para caber dentro do campo de visão de um telescópio, mas será
                visível a olho nu ou com um par de binóculos. <br> <br>


            </p>

            <div class="curtida-postagem">
                <p class="likes">
                    <i id="botaoCurtir" onclick="curtir()" class="fa-solid fa-thumbs-up fa-2x"></i>
                    <span id="numero_curtidas"></span>
                </p>
            </div>

            <div class="comentarios-postagem">

                <h3>Comentarios</h3>

                <div id="comentario">
                    <div id="feed_container" class="feed-container"></div>
                </div>

                <form id="form_postagem" method="post" onsubmit="return publicar()">

                    <h3>Deixe um comentário</h3>

                    <textarea id="textarea_descricao" name="descricao" maxlength="300"></textarea>

                    <button>Enviar</button>
                    <div id="erro_comentario"></div>

                </form>

            </div>

        </div>

    </div>

    <!--Rodapé-->
    <div class="rodape">
        <a><img src="../assets/LOGOTIPO.png" alt="Logo Cosmos"></a>
        <div class="rodape-links">
            <div class="links">
                <a href="#"><img src="../assets/facebook.png" alt="facebook"></a>
                <a href="#"><img src="../assets/instagram.png" alt="instagram"></a>
                <a href="#"><img src="../assets/twitter.png" alt="twiter"></a>
                <p>
                    <a href="blog.html">Blog</a>
                </p>
                <p>© 2023 Cosmos. All Rights Reserved</p>
            </div>
        </div>
    </div>




    <script src="https://kit.fontawesome.com/d4c069e090.js" crossorigin="anonymous"></script>

</body>

</html>
<script>

    var idPost = 6;
    var idUsuario = sessionStorage.ID_USUARIO;


    function limparFormulario() {
        document.getElementById("form_postagem").reset();
    }

    function verificarCurtida(idUsuario, idPost) {
        fetch(`/comentarios/verificarCurtida/${idUsuario}/${idPost}`)

        console.log('Verificar Curtidas' + idPost)

            .then(function (resposta) {
                if (resposta.ok) {
                    return resposta.json();

                } else {
                    throw new Error('Erro ao verificar curtida');
                }
            })
            .then(function (resposta) {
                console.log('Resultado da curtida', resposta.curtiu);
                sessionStorage.setItem(`CURTIDA_POST${idPost}`, resposta.curtiu);
            })
            .catch(function (erro) {
                console.error('Erro:', erro);
            });
    }


    function curtir() {
        var jaCurtiu = sessionStorage.getItem(`curtida_${idPost}`);

        if (jaCurtiu) {
            alert("Você já curtiu esta postagem!");
        } else {
            // Antes de enviar a solicitação, verifica se o usuário já curtiu
            fetch(`/comentarios/verificarCurtida/${idUsuario}/${idPost}`)
                .then(function (resposta) {
                    if (resposta.ok) {
                        return resposta.json();
                    } else {
                        throw new Error('Erro ao verificar curtida');
                    }
                })
                .then(function (resposta) {
                    if (!resposta.curtiu) {
                        // Se o usuário ainda não curtiu, então envie a solicitação de curtir
                        return fetch(`/comentarios/curtir/${idUsuario}/${idPost}`, {
                            method: "post",
                            headers: {
                                "Content-Type": "application/json"
                            },
                        });
                    } else {
                        alert("Você já curtiu este post!");
                        return Promise.reject('Usuário já curtiu');
                    }
                })
                .then(function (resposta) {
                    if (resposta.ok) {
                        alert("Post curtido");
                        window.location = "/dashboard/post6.html";
                        console.log("idCurtida realizada com sucesso");

                        sessionStorage.setItem(`CURTIDA_POST${idPost}`, true);

                        // Chama a função verificarCurtida para atualizar o estado no sessionStorage
                        verificarCurtida(idUsuario, idPost);

                        // finalizarAguardar();
                    } else if (resposta.status == 404) {
                        window.alert("Deu 404!");
                    } else {
                        throw new Error("Houve um erro ao tentar realizar a curtida! Código da resposta: " + resposta.status);
                    }
                })
                .catch(function (erro) {
                    console.log(`#ERRO: ${erro}`);
                    // finalizarAguardar();
                });

            return false;
        }
    }

    function publicar() {

        var corpo = {
            descricao: form_postagem.descricao.value
        }

        if (!corpo.descricao.trim()) { // Remove espaços em branco no início e no fim

            // Se a descrição estiver vazia ou nula, exibir mensagem de erro e não enviar o formulário
            erro_comentario.innerHTML = "O comentário não pode ser vazio";
            return false;
        }

        fetch(`/comentarios/publicar/${idUsuario}/${idPost}`, {
            method: "post",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(corpo)
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                window.location = "/dashboard/post6.html";
                console.log("idPost em publicar:", idPost);

                limparFormulario();
                // finalizarAguardar();
            } else if (resposta.status == 404) {
                window.alert("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar o comentario! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            // finalizarAguardar();
        });

        return false;

    }

    function atualizarFeed() {
        fetch(`/comentarios/listar/${idPost}`).then(function (resposta) {

            console.log('Atualizar' + idPost);

            if (resposta.ok) {
                if (resposta.status == 204) {
                    var feed = document.getElementById("feed_container");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum comentario foi feito";
                    mensagem.classList.add("mensagem");
                    feed.appendChild(mensagem);
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    var feed = document.getElementById("feed_container");
                    feed.innerHTML = "";
                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];

                        // criando e manipulando elementos do HTML via JavaScript
                        var divPublicacao = document.createElement("div");
                        var spanNome = document.createElement("span");
                        var divDescricao = document.createElement("div");

                        spanNome.innerHTML = `<img width="60px" heigth="60px" style="border-radius: 50%;" src="${publicacao.imagem}"> ${publicacao.nome}`;
                        divDescricao.innerHTML = publicacao.descricao;

                        divPublicacao.className = "publicacao";
                        spanNome.className = "publicacao-nome";
                        divDescricao.className = "publicacao-descricao"

                        divPublicacao.appendChild(spanNome);
                        divPublicacao.appendChild(divDescricao);
                        feed.appendChild(divPublicacao);
                    }

                    // finalizarAguardar();
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
            // finalizarAguardar();
        });

        // Incluir contagem de curtidas
        fetch(`/comentarios/contarCurtidas/${idPost}`)
            .then(function (resposta) {
                if (resposta.ok) {
                    return resposta.json();
                } else {
                    throw new Error('Erro ao contar curtidas');
                }
            })
            .then(function (resposta) {
                // Exibir a contagem de curtidas na interface do usuário
                var numeroCurtidas = resposta.numeroCurtidas;
                var numeroCurtidasElement = document.getElementById("numero_curtidas");
                numeroCurtidasElement.innerHTML = numeroCurtidas;
            })
            .catch(function (erro) {
                console.error('Erro:', erro);
            });

    }


</script>