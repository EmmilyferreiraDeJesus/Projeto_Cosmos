<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../js/sessao.js"></script>

    <!--Link CSS-->
    <link rel="stylesheet" href="../css/estilo.css">
    <!--Link Google Icons-->
    <link rel="shortcut icon" href="../assets/LOGOTIPO.png" type="image/x-icon">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <title>Cosmos | O que é e como se forma a poeira cósmica?</title>
</head>

<!-- validarSessao(), -->

<body onload="atualizarFeed()">

    <!--Container com a imagem principal e header-->
    <div class="container-principal-blog">

        <div class="header">
            <div class="container">

                <p class="email">
                    <span class="material-symbols-outlined">mail</span>
                    <a href="#">emmily.ferreira@spetch.school</a>
                </p>

                <a><img class="logo-blog" src="../assets/LOGOTIPO.png" alt="Logo Cosmos"></a>

                <div class="navbar">
                    <ul>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="#" onclick="limparSessao()">Sair</a></li>
                    </ul>
                </div>
            </div>

            <div class="conteudo-principal-blog">

                <h1>Blog</h1>

            </div>

        </div>

    </div>


    <!--Container da postagem-->
    <div class="container-postagem">

        <div class="postagem">

            <h1>O que é e como se forma a poeira cósmica?</h1>
            <p class="data-post-p">
                <span class="material-symbols-outlined icon">calendar_clock</span>
                Outubro 09, 2023 ás 10:36
            </p>

            <p>Saiba um pouco mais sobre a poeira cósmica, as nuvens de partículas de material sólido que flutuam pelo
                espaço</p>

            <img src="../assets/nebulosa-1.jpg">

            <p> A astronomia está repleta de elementos fantásticos e de grandes dimensões, como estrelas, nebulosas,
                planetas e galáxias. Porém, nem só desses itens é formado o Universo, que também conta com componentes
                bastante pequenos. <br> <br>

                É o caso da poeira cósmica, um véu que permeia o Cosmos formado por corpos tão pequenos quanto grãos de
                areia, com minúsculas partículas sólidas que flutuam no espaço interestelar. <br> <br>

                Mesmo com seu tamanho minúsculo perto de outras estruturas espaciais, a poeira cósmica tem uma grande
                importância para a astronomia, como o espalhamento e bloqueio da luz. Conheça mais sobre essa incrível
                formação, em seguida. <br> <br>
            </p>

            <h3>Poeira cósmica: o que é, como se forma e qual a sua importância?</h3>

            <p>
                A poeira cósmica é formada por partículas sólidas, como silicato e fragmentos de carbono, além de restos
                de explosão solar, formação de estrelas ou de cometas e asteroides. Só é possível observá-la através de
                microscópio, uma vez que seu tamanho não passa de um mícron (milésima parte do milímetro) de diâmetro. <br> <br>

                Seu ciclo começa nas estrelas, onde ela é formada, para depois ser soprada por algum tipo de explosão
                estelar. Os grãos se misturam com gás espacial, e acabam formando grandes ou pequenas nuvens de gás,
                chamadas de nebulosas. <br> <br>

                Não é fácil detectar a poeira cósmica, já que a atmosfera terrestre é opaca à radiação das ondas da
                poeira, não sendo possível visualizar as luzes infravermelhas dessas nuvens de dentro do planeta. <br> <br>

                Porém, os astrônomos contam com uma variedade de técnicas para estudar os grãos celestiais, como
                observações em diferentes faixas do espectro eletromagnético, e instrumentos que permitem a visualização
                das luzes infravermelhas. <br> <br>

                Sua importância na astronomia é imensa, já que ela serve como uma espécie de arquivista cósmico,
                mantendo preservadas pistas sobre a formação de estrelas, planetas e até mesmo a evolução química do
                universo. <br> <br>
            </p>

            <img src="../assets/Nebulosa-da-Agua-viva-IC-443.jpg">

            <p><em>A Nebulosa da Água-viva (IC 443) é um remanescente de supernova (SNR) na constelação de Gêmeos – Astronomy Photographer of the Year — Foto: Peter Larkin</em></p>

            <p>
                A poeira cósmica também desempenha um papel fundamental na formação de sistemas planetários, e na
                absorção e dispersão da luz estelar, implicando de forma direta na nossa capacidade de observar e
                entender o universo a nossa volta. <br> <br>

                Além de ser responsável pelo espalhamento e bloqueio da luz, a poeira ajuda no equilíbrio da
                temperatura, impactando na criação de novas estrelas, e também pode facilitar a formação de moléculas.

                Ela também é essencial na vida de estrelas jovens, já que auxilia o corpo celeste a tomar forma. O
                material cru da poeira cósmica também é usado por planetas para ganhar formato no espaço. <br> <br>

                Recentemente, uma pesquisa comprovou que o astrofísico Carl Sagan estava certo ao dizer que os humanos
                são feitos de poeira de estrela. Após analisar 1500 estrelas, astrônomos chegaram à conclusão de que,
                tanto os seres humanos, quanto os astros brilhantes, possuem 97% do mesmo tipo de átomos. <br> <br>
            </p>


            <div class="curtida-postagem">
                <p class="likes">
                    <i id="botaoCurtir" onclick="curtir()" class="fa-solid fa-thumbs-up fa-2x"></i>
                    <span id="numero_curtidas"></span>
                </p>
            </div>

            <div class="comentarios-postagem">

                <h3>Comentarios</h3>

                <div id="comentario">
                    <div id="feed_container" class="feed-container"></div>
                </div>

                <form id="form_postagem" method="post" onsubmit="return publicar()">

                    <h3>Deixe um comentário</h3>

                    <textarea id="textarea_descricao" name="descricao" maxlength="300"></textarea>

                    <button>Enviar</button>
                    <div id="erro_comentario"></div>

                </form>

            </div>

        </div>

    </div>

    <!--Rodapé-->
    <div class="rodape">
        <a><img src="../assets/LOGOTIPO.png" alt="Logo Cosmos"></a>
        <div class="rodape-links">
            <div class="links">
                <a href="#"><img src="../assets/facebook.png" alt="facebook"></a>
                <a href="#"><img src="../assets/instagram.png" alt="instagram"></a>
                <a href="#"><img src="../assets/twitter.png" alt="twiter"></a>
                <p>
                    <a href="blog.html">Blog</a>
                </p>
                <p>© 2023 Cosmos. All Rights Reserved</p>
            </div>
        </div>
    </div>




    <script src="https://kit.fontawesome.com/d4c069e090.js" crossorigin="anonymous"></script>

</body>

</html>
<script>

    var idPost = 3;
    var idUsuario = sessionStorage.ID_USUARIO;


    function limparFormulario() {
        document.getElementById("form_postagem").reset();
    }

    function verificarCurtida(idUsuario, idPost) {
        fetch(`/comentarios/verificarCurtida/${idUsuario}/${idPost}`)

        console.log('Verificar Curtidas' + idPost)

            .then(function (resposta) {
                if (resposta.ok) {
                    return resposta.json();

                } else {
                    throw new Error('Erro ao verificar curtida');
                }
            })
            .then(function (resposta) {
                console.log('Resultado da curtida', resposta.curtiu);
                sessionStorage.setItem(`CURTIDA_POST${idPost}`, resposta.curtiu);
            })
            .catch(function (erro) {
                console.error('Erro:', erro);
            });
    }


    function curtir() {
        var jaCurtiu = sessionStorage.getItem(`curtida_${idPost}`);

        if (jaCurtiu) {
            alert("Você já curtiu esta postagem!");
        } else {
            // Antes de enviar a solicitação, verifica se o usuário já curtiu
            fetch(`/comentarios/verificarCurtida/${idUsuario}/${idPost}`)
                .then(function (resposta) {
                    if (resposta.ok) {
                        return resposta.json();
                    } else {
                        throw new Error('Erro ao verificar curtida');
                    }
                })
                .then(function (resposta) {
                    if (!resposta.curtiu) {
                        // Se o usuário ainda não curtiu, então envie a solicitação de curtir
                        return fetch(`/comentarios/curtir/${idUsuario}/${idPost}`, {
                            method: "post",
                            headers: {
                                "Content-Type": "application/json"
                            },
                        });
                    } else {
                        alert("Você já curtiu este post!");
                        return Promise.reject('Usuário já curtiu');
                    }
                })
                .then(function (resposta) {
                    if (resposta.ok) {
                        alert("Post curtido");
                        window.location = "/dashboard/post3.html";
                        console.log("idCurtida realizada com sucesso");

                        sessionStorage.setItem(`CURTIDA_POST${idPost}`, true);

                        // Chama a função verificarCurtida para atualizar o estado no sessionStorage
                        verificarCurtida(idUsuario, idPost);

                        // finalizarAguardar();
                    } else if (resposta.status == 404) {
                        window.alert("Deu 404!");
                    } else {
                        throw new Error("Houve um erro ao tentar realizar a curtida! Código da resposta: " + resposta.status);
                    }
                })
                .catch(function (erro) {
                    console.log(`#ERRO: ${erro}`);
                    // finalizarAguardar();
                });

            return false;
        }
    }

    function publicar() {

        var corpo = {
            descricao: form_postagem.descricao.value
        }

        if (!corpo.descricao.trim()) { // Remove espaços em branco no início e no fim

            // Se a descrição estiver vazia ou nula, exibir mensagem de erro e não enviar o formulário
            erro_comentario.innerHTML = "O comentário não pode ser vazio";
            return false;
        }

        fetch(`/comentarios/publicar/${idUsuario}/${idPost}`, {
            method: "post",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(corpo)
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                window.location = "/dashboard/post3.html";
                console.log("idPost em publicar:", idPost);

                limparFormulario();
                // finalizarAguardar();
            } else if (resposta.status == 404) {
                window.alert("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar o comentario! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            // finalizarAguardar();
        });

        return false;

    }

    function atualizarFeed() {
        fetch(`/comentarios/listar/${idPost}`).then(function (resposta) {

            console.log('Atualizar' + idPost);

            if (resposta.ok) {
                if (resposta.status == 204) {
                    var feed = document.getElementById("feed_container");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum comentario foi feito";
                    mensagem.classList.add("mensagem");
                    feed.appendChild(mensagem);
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    var feed = document.getElementById("feed_container");
                    feed.innerHTML = "";
                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];

                        // criando e manipulando elementos do HTML via JavaScript
                        var divPublicacao = document.createElement("div");
                        var spanNome = document.createElement("span");
                        var divDescricao = document.createElement("div");

                        spanNome.innerHTML = `<img width="60px" heigth="60px" style="border-radius: 50%;" src="${publicacao.imagem}"> ${publicacao.nome}`;
                        divDescricao.innerHTML = publicacao.descricao;

                        divPublicacao.className = "publicacao";
                        spanNome.className = "publicacao-nome";
                        divDescricao.className = "publicacao-descricao"

                        divPublicacao.appendChild(spanNome);
                        divPublicacao.appendChild(divDescricao);
                        feed.appendChild(divPublicacao);
                    }

                    // finalizarAguardar();
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
            // finalizarAguardar();
        });

        // Incluir contagem de curtidas
        fetch(`/comentarios/contarCurtidas/${idPost}`)
            .then(function (resposta) {
                if (resposta.ok) {
                    return resposta.json();
                } else {
                    throw new Error('Erro ao contar curtidas');
                }
            })
            .then(function (resposta) {
                // Exibir a contagem de curtidas na interface do usuário
                var numeroCurtidas = resposta.numeroCurtidas;
                var numeroCurtidasElement = document.getElementById("numero_curtidas");
                numeroCurtidasElement.innerHTML = numeroCurtidas;
            })
            .catch(function (erro) {
                console.error('Erro:', erro);
            });

    }


</script>